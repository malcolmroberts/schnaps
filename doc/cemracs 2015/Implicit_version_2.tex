\documentclass[a4paper, 11pt]{article}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}      
\usepackage[english]{babel}  
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{mathrsfs}
\usepackage{stmaryrd}
\usepackage{color}
\usepackage{cases}
\usepackage{dsfont}
\usepackage{lscape}
\usepackage{graphicx}
\usepackage{subfigure}
\newtheorem{Lemma}{Lemma}
\newtheorem{Proposition}{Proposition}
\newtheorem{Remark}{Remark}
\newtheorem{Theorem}{Theorem}
\newtheorem{Corollary}{Corollary}
\newtheorem{Definition}{Definition}
\usepackage{lettrine}
\bibliographystyle{alpha}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,                         
    linkcolor=red, % Couleur des liens internes
    citecolor=blue, % Couleur des num√©ros de la biblio dans le corps
    urlcolor=green  } % Couleur des url
\renewcommand{\thefootnote}{\arabic{footnote}}

\begin{document}
\title{Shallow Water : $\theta$-implicit scheme \\ WITHOUT DIVIDED BY H}
\date{August 10, 2015}
\author{}
\maketitle
\section{Essay 1}
Let us consider the following system (Shallow Water without the source term).
\begin{equation*}
\left\{
\begin{split}
&\partial_t h+\text{div}\left(\boldsymbol{u}h\right)=0,\\
&\partial_t \left(h\boldsymbol{u}\right)+\text{div}\left(h\boldsymbol{u}\otimes \boldsymbol{u}\right)+\nabla p=0,
\end{split}
\right.
\end{equation*}
where $p=\frac{gh^2}{2}.$\\
We use the non conservative variables : $h$ and $\boldsymbol{u}$, and the relations
\begin{equation*}
\text{div}\left(h\boldsymbol{u}\right)=\nabla h\cdot\boldsymbol{u}+h\text{div}\left(\boldsymbol{u}\right),
\end{equation*}
and
\begin{equation*}
\text{div}\left(h\boldsymbol{u}\otimes\boldsymbol{u}\right)=\boldsymbol{u}\text{div}\left(h\boldsymbol{u}\right)+h\left(\boldsymbol{u}\cdot\nabla\right)\boldsymbol{u},
\end{equation*}
where
\begin{equation*}
\left(\boldsymbol{u}\cdot\nabla\right)\boldsymbol{v}=\begin{pmatrix}u_1\partial_xv_1+u_2\partial_yv_1\\u_1\partial_xv_2+u_2\partial_yv_2\end{pmatrix}
\end{equation*}
to obtain 
\begin{equation*}
\left\{\begin{split}
&\partial_t h+h\text{div}(\boldsymbol{u})+\nabla h\cdot \boldsymbol{u}=0,\\
&h\partial_t \boldsymbol{u}+h\left(\boldsymbol{u}\cdot \nabla\right)\boldsymbol{u}+\nabla p=0.
\end{split}\right.
\end{equation*}

Due to the expression of the pressure $p$ one has 
\begin{equation*}
\left\{\begin{split}
&\partial_t h+\text{div}\left(h\boldsymbol{u}\right)=0,\\
&h\partial_t \boldsymbol{u}+h\left(\boldsymbol{u}\cdot \nabla\right)\boldsymbol{u}+gh\nabla h=0.
\end{split}\right.
\end{equation*}

The semi-discrete scheme ($\theta$-scheme in time and continuous in space) of this system is
\begin{equation*}
\left\{\begin{split}
&\frac{h^{n+1}-h^n}{\Delta t}+\theta\text{div}\left(h^{n+1}\boldsymbol{u}^{n+1}\right)+(1-\theta)\text{div}\left(h^{n}\boldsymbol{u}^{n}\right)=0,\\
&h^n\frac{\boldsymbol{u}^{n+1}-\boldsymbol{u}^{n}}{\Delta t}+\theta h^{n+1}\left(\boldsymbol{u}^{n+1}\cdot \nabla\right)\boldsymbol{u}^{n+1}+(1-\theta) h^{n}\left(\boldsymbol{u}^{n}\cdot \nabla\right)\boldsymbol{u}^{n}+\theta gh^{n+1}\nabla h^{n+1}\\
&\hspace*{8.7cm}+(1-\theta)gh^n\nabla h^n=0.
\end{split}\right.
\end{equation*}
Hence, one has
\begin{equation*}
\left\{
\begin{split}
&h^{n+1}+\theta\Delta t\text{div}\left(h^{n+1}\boldsymbol{u}^{n+1}\right)=h^n-\Delta t(1-\theta)\text{div}\left(h^n\boldsymbol{u}^n\right),\\
&h^n\boldsymbol{u}^{n+1}+\theta\Delta th^{n+1}\left(\boldsymbol{u}^{n+1}\cdot\nabla\right)\boldsymbol{u}^{n+1}+\theta\Delta th^{n+1}g\nabla h^{n+1}\\
&\hspace*{6cm}=h^n\boldsymbol{u}^n-\Delta t(1-\theta)h^n\left(\boldsymbol{u}^n\cdot \nabla\right)\boldsymbol{u}^n-\Delta t(1-\theta)gh^n\nabla h^n.
\end{split}
\right.
\end{equation*}
This system can be rewritten in the form
\begin{equation*}
G\begin{pmatrix}h^{n+1}\\u_1^{n+1}\\u_2^{n+1}\end{pmatrix}=B\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix},
\end{equation*}
with 
\begin{equation*}
G:\begin{pmatrix}h\\u\\v\end{pmatrix}\mapsto\begin{pmatrix}h+\theta\Delta t\text{div}\left(h(u,v)\right)\\
\textcolor{red}{h}u+\theta\Delta t h\left(u\partial_xu+v\partial_yu\right)+\theta \Delta thg\partial_x h\\
\textcolor{red}{h}v+\theta\Delta t h\left(u\partial_xv+v\partial_yv\right)+\theta \Delta thg\partial_y h
\end{pmatrix}
\end{equation*}
and
\begin{equation*}
B:
\begin{pmatrix}
h\\u\\v
\end{pmatrix}\mapsto\begin{pmatrix}h-\Delta t(1-\theta)\text{div}(h(u,v))\\
hu-\Delta t(1-\theta)h\left(u\partial_xu+v\partial_yu\right)-\Delta t(1-\theta)hg\partial_x h\\
hv-\Delta t(1-\theta)h\left(u\partial_xv+v\partial_yv\right)-\Delta t(1-\theta)hg\partial_y h
\end{pmatrix}
\end{equation*}


However, 
a linearisation of $G$ gives
\begin{equation*}
G\begin{pmatrix}h^{n+1}\\u_1^{n+1}\\u_2^{n+1}\end{pmatrix}=G\begin{pmatrix}h^{n}\\u_1^{n}\\u_2^{n}\end{pmatrix}+J_{ac_G}\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}\underbrace{\left(\begin{pmatrix}h^{n+1}\\u_1^{n+1}\\u_2^{n+1}\end{pmatrix}-\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}\right)}_{\begin{pmatrix}\delta h^n\\\delta u_1^n\\\delta u_2^n\end{pmatrix}}+\mathcal{O}\left(\begin{pmatrix}(\delta h^n)^2\\(\delta u_1^n)^2\\(\delta u_2^n)^2\end{pmatrix}\right),
\end{equation*}
where $J_{ac_G}$ is the Jacobian matrix of $G$.
Neglecting the second order terms yields to the linearised system
\begin{equation*}
G\begin{pmatrix}h^{n}\\u_1^{n}\\u_2^{n}\end{pmatrix}+J_{ac_G}\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}\left(\begin{pmatrix}\delta h^n\\\delta u_1^n\\\delta u_2^n\end{pmatrix}\right)=B\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}
\end{equation*}
So
\begin{equation*}
J_{ac_G}\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}\left(\begin{pmatrix}\delta h^n\\\delta u_1^n\\\delta u_2^n\end{pmatrix}\right)=B\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}-G\begin{pmatrix}h^{n}\\u_1^{n}\\u_2^{n}\end{pmatrix}.
\end{equation*}
\begin{landscape}
\subsection{Calculus of the Jacobian}
We eventually find
\begin{equation*}
\begin{split}
&\hspace*{-3cm}J_{ac_G}\left(\begin{pmatrix}h\\u\\v\end{pmatrix}\right)\\&\hspace*{-3cm}=
\begin{pmatrix}
I_1+\theta\Delta t\boldsymbol{u}\cdot\left(\nabla I_1\right)+\theta\Delta t\text{div}\left(\boldsymbol{u}\right)I_1& \theta\Delta t(\partial_xh)I_1+h\theta\Delta t(\partial_xI_1)&\theta\Delta t(\partial_yh)I_1+h\theta\Delta t(\partial_yI_1)\\
\theta\Delta tgh(\partial_xI_1)+\theta\Delta tg\left(\partial_xh\right)I_1+\theta\Delta t\left(u\partial_xu+v\partial_yu\right)I_1+uI_1 & hI_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thI_1(\partial_xu)+\theta\Delta thv(\partial_yI_1)&h\theta\Delta tI_1\partial_y u\\
\theta\Delta thg(\partial_yI_1)+\theta\Delta tg\left(\partial_yh\right)I_1+\theta\Delta tI_1(u\partial_xv+v\partial_yv)+vI_1&h\theta\Delta tI_1\partial_x v&hI_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thv(\partial_yI_1)+\theta\Delta thI_1\partial_yv
\end{pmatrix}
\end{split}
\end{equation*}
when $I_d$ is the $d\times d$-Identity matrix.
The RHS term becomes
\begin{equation*}
\begin{split}
&B\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}-G\begin{pmatrix}h^{n}\\u_1^{n}\\u_2^{n}\end{pmatrix}\\
&=\begin{pmatrix}h^n-\Delta t(1-\theta)\text{div}(h^n\boldsymbol{u}^n)-h^n-\theta\Delta t\text{div}(h^n\boldsymbol{u}^n)\\
h^nu_1^n-\Delta th^n(1-\theta)(u_1^n\partial_xu_1^n+u_2^n\partial_yu_1^n)-\Delta t(1-\theta)gh^n\partial_xh^n-h^nu_1^n-\theta h^n\Delta t(u_1^n\partial_xu_1^n+u_2^n\partial_yu_1^n)-\theta\Delta th^ng\partial_xh^n\\
h^nu_2^n-\Delta t(1-\theta)h^n(u_1^n\partial_xu_2^n+u_2^n\partial_yu_2^n)-\Delta t(1-\theta)h^ng\partial_yh^n-h^nu_2^n-\Delta t\theta h^n(u_1^n\partial_xu_2^n+u_2^n\partial_yu_2^n)-\theta g\Delta th^n\partial_yh^n\end{pmatrix}
\end{split}
\end{equation*}

The linearised system becomes
\begin{equation*}
\begin{split}
&\begin{pmatrix}
I_1+\theta\Delta t\text{div}\left(\boldsymbol{u}^nI_1\right)&\theta\Delta t\partial_x\left(h^nI_1\right)&\theta\Delta t\partial_y\left(h^nI_1\right)\\
u^n_1I_1+\theta\Delta t g\partial_x\left(h^nI_1\right)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n&h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot \nabla\right)I_1+\theta\Delta th^n(\partial_xu_1^n)I_1&\theta\Delta th^n(\partial_yu_1^n)I_1\\
u_2^nI_1+\theta\Delta tg\partial_y\left(h^nI_1\right)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n&\theta\Delta tI_1h^n\partial_xu_2^n&h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_1+\theta\Delta th^n(\partial_yu_2^n)I_1
\end{pmatrix}
\begin{pmatrix}
\delta h^n\\\delta u_1^n\\\delta u_2^n\end{pmatrix}\\
&=\begin{pmatrix}-\Delta t\text{div}(h^n\boldsymbol{u}^n)\\-\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n-\Delta tgh^n\partial_xh^n\\-\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n-\Delta tgh^n\partial_y h^n\end{pmatrix}
\end{split}
\end{equation*}

\end{landscape}

\subsection{Schur decomposition}

We denote 
\begin{equation*}
J_{ac_G}=\begin{pmatrix}D_1&U\\L&D_2\end{pmatrix}
\end{equation*}
with
\begin{equation*}
D_1=I_1+\theta\Delta t\text{div}(\boldsymbol{u}^nI_1),
\end{equation*}
\begin{equation*}
U=\begin{pmatrix}\theta\Delta t\partial_x\left(h^nI_1\right)&\theta\Delta t\partial_y\left(h^nI_1\right)\end{pmatrix}=\theta\Delta t\nabla\left(h^nI_1\right)^t
\end{equation*}
\begin{equation*}
L=\begin{pmatrix}
u_1^nI_1+\theta\Delta t g\partial_x(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n\\
u_2^nI_1+\theta\Delta tg\partial_y(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n
\end{pmatrix}
\end{equation*}
and
\begin{equation*}
D_2=\begin{pmatrix}h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot \nabla\right)I_1+\theta\Delta th^n(\partial_xu_1^n)I_1&\theta\Delta th^n(\partial_yu_1^n)I_1\\
\theta\Delta tI_1h^n\partial_xu_2^n&h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_1+\theta\Delta th^n(\partial_yu_2^n)I_1
\end{pmatrix}
\end{equation*}
The Schur decomposition of the Jacobian matrix is $P_{schur}=D_2-LD_1^{-1}U$.\\
\textbf{Hypothesis} We assume that $D_1=I_1$.\\

We need to compute the product $LU$ to find the $P_{schur}$.
We find
\begin{tiny}
\begin{equation*}
\begin{split}
&\hspace*{-2cm}LU=\\
&\hspace*{-2cm}\begin{pmatrix}
u_1^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&u_1^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y\left(h^nI_1\right)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
u_2^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n&u_2^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n
\end{pmatrix}\\
&\hspace*{-2cm}=\begin{pmatrix}u_1^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_x\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&u_1^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_{x}\left(h^n\partial_y((h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
u_2^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_y\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot \nabla)u_2^n&u_2^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_{y}\left(h^n\partial_y(h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n\end{pmatrix}
\end{split}
\end{equation*}
\end{tiny}
We eventually find

\begin{equation*}
LU(\delta \boldsymbol{u})=\theta\Delta t\nabla\cdot\left(h^n\delta \boldsymbol{u}\right)\boldsymbol{u}^n+\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^n\delta\boldsymbol{u}\right)\right)+\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^n\delta \boldsymbol{u}).
\end{equation*}

To conclude, one has the Schur matrix 
\begin{small}
\begin{equation*}
\hspace*{-3cm}P_{schur}=h^nI_2+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_2+\theta\Delta th^n\nabla\boldsymbol{u}^nI_2-\theta\Delta t\nabla\cdot\left(h^nI_2\right)\boldsymbol{u}^n-\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^nI_2\right)\right)-\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^nI_2),
\end{equation*}
\end{small}
with $\nabla\boldsymbol{u}^n$ the Jacobian matrix of $\boldsymbol{u}^n$, ie
\begin{equation*}
\nabla\boldsymbol{u}^n=
\begin{pmatrix}
\partial_x u_1^n &\partial_y u_1^n\\ \partial_x u_2^n &\partial_y u_2^n
\end{pmatrix}.
\end{equation*}

\subsection{The three sub-equations}
Thanks to the Schur decomposition one has the three systems (see also the document du 31 juillet)
\begin{equation*}
(Syst_1)\left\{\begin{split}
&\delta h^*=-\Delta t\text{div}(h^n\boldsymbol{u}^n),\\
&L\delta h^*+\delta \boldsymbol{u}^*=-\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n-\Delta tg\nabla h^n,
\end{split}\right.
\end{equation*}
\begin{equation*}
(Syst_2)\left\{\begin{split}
&\delta h^{**}=\delta h^*,\\
&(D_2-LU)\delta \boldsymbol{u}^{**}=\delta \boldsymbol{u}^{*},
\end{split}
\right.
\end{equation*}
and

\begin{equation*}
(Syst_3)\left\{\begin{split}
&\delta h^{n+1}+U\delta \boldsymbol{u}^{n+1}=\delta h^{**},\\
&\delta \boldsymbol{u}^{n+1}=\delta \boldsymbol{u}^{**}.
\end{split}\right.
\end{equation*}
Hence it yields
\begin{equation*}
\left\{
\begin{split}
&\delta h^{*}=-\Delta t\text{div}(h^n\boldsymbol{u}^n),\\
&(D_2-LU)\delta \boldsymbol{u}^{n+1}=-L\delta h^*-\Delta th^n(\boldsymbol{u}^n\cdot\nabla)\boldsymbol{u}^n-\Delta tg\nabla h^n,\\
&\delta h^{n+1}=\delta h^*-U\delta \boldsymbol{u}^{n+1}.
\end{split}\right.
\end{equation*}
\section{Essay 2}
For the application $G$ we choose here
\begin{equation*}
G:\begin{pmatrix}h\\u\\v\end{pmatrix}\mapsto\begin{pmatrix}h+\theta\Delta t\text{div}\left(h(u,v)\right)\\
\textcolor{red}{h^n}u+\theta\Delta t h\left(u\partial_xu+v\partial_yu\right)+\theta \Delta thg\partial_x h\\
\textcolor{red}{h^n}v+\theta\Delta t h\left(u\partial_xv+v\partial_yv\right)+\theta \Delta thg\partial_y h
\end{pmatrix}.
\end{equation*}

So the Jacobian matrix is
\begin{landscape}
\begin{equation*}
\begin{split}
&\hspace*{-3cm}J_{ac_G}\left(\begin{pmatrix}h\\u\\v\end{pmatrix}\right)\\&\hspace*{-3cm}=
\begin{pmatrix}
I_1+\theta\Delta t\boldsymbol{u}\cdot\left(\nabla I_1\right)+\theta\Delta t\text{div}\left(\boldsymbol{u}\right)I_1& \theta\Delta t(\partial_xh)I_1+h\theta\Delta t(\partial_xI_1)&\theta\Delta t(\partial_yh)I_1+h\theta\Delta t(\partial_yI_1)\\
\theta\Delta tgh(\partial_xI_1)+\theta\Delta tg\left(\partial_xh\right)I_1+\theta\Delta t\left(u\partial_xu+v\partial_yu\right)I_1 & h^nI_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thI_1(\partial_xu)+\theta\Delta thv(\partial_yI_1)&h\theta\Delta tI_1\partial_y u\\
\theta\Delta thg(\partial_yI_1)+\theta\Delta tg\left(\partial_yh\right)I_1+\theta\Delta tI_1(u\partial_xv+v\partial_yv)&h\theta\Delta tI_1\partial_x v&h^nI_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thv(\partial_yI_1)+\theta\Delta thI_1\partial_yv
\end{pmatrix}
\end{split}
\end{equation*}
when $I_d$ is the $d\times d$-Identity matrix.
The RHS term becomes
\begin{equation*}
\begin{split}
&B\begin{pmatrix}h^n\\u_1^n\\u_2^n\end{pmatrix}-G\begin{pmatrix}h^{n}\\u_1^{n}\\u_2^{n}\end{pmatrix}\\
&=\begin{pmatrix}h^n-\Delta t(1-\theta)\text{div}(h^n\boldsymbol{u}^n)-h^n-\theta\Delta t\text{div}(h^n\boldsymbol{u}^n)\\
h^nu_1^n-\Delta th^n(1-\theta)(u_1^n\partial_xu_1^n+u_2^n\partial_yu_1^n)-\Delta t(1-\theta)gh^n\partial_xh^n-h^nu_1^n-\theta h^n\Delta t(u_1^n\partial_xu_1^n+u_2^n\partial_yu_1^n)-\theta\Delta th^ng\partial_xh^n\\
h^nu_2^n-\Delta t(1-\theta)h^n(u_1^n\partial_xu_2^n+u_2^n\partial_yu_2^n)-\Delta t(1-\theta)h^ng\partial_yh^n-h^nu_2^n-\Delta t\theta h^n(u_1^n\partial_xu_2^n+u_2^n\partial_yu_2^n)-\theta g\Delta th^n\partial_yh^n\end{pmatrix}
\end{split}
\end{equation*}

The linearised system becomes
\begin{equation*}
\begin{split}
&\begin{pmatrix}
I_1+\theta\Delta t\text{div}\left(\boldsymbol{u}^nI_1\right)&\theta\Delta t\partial_x\left(h^nI_1\right)&\theta\Delta t\partial_y\left(h^nI_1\right)\\
\theta\Delta t g\partial_x\left(h^nI_1\right)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n&h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot \nabla\right)I_1+\theta\Delta th^n(\partial_xu_1^n)I_1&\theta\Delta th^n(\partial_yu_1^n)I_1\\
\theta\Delta tg\partial_y\left(h^nI_1\right)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n&\theta\Delta tI_1h^n\partial_xu_2^n&h^nI_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_1+\theta\Delta th^n(\partial_yu_2^n)I_1
\end{pmatrix}
\begin{pmatrix}
\delta h^n\\\delta u_1^n\\\delta u_2^n\end{pmatrix}\\
&=\begin{pmatrix}-\Delta t\text{div}(h^n\boldsymbol{u}^n)\\-\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n-\Delta tgh^n\partial_xh^n\\-\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n-\Delta tgh^n\partial_y h^n\end{pmatrix}
\end{split}
\end{equation*}

\end{landscape}
Here one has the same $U$,
but 
\begin{equation*}
L=\begin{pmatrix}
\theta\Delta t g\partial_x(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n\\
\theta\Delta tg\partial_y(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n
\end{pmatrix}
\end{equation*}
and the same $D_2$.
We always assume that $D_1=I_1$.\\

In that case, the product $LU$ is equal to
\begin{tiny}
\begin{equation*}
\begin{split}
&\hspace*{-2cm}LU=\\
&\hspace*{-2cm}\begin{pmatrix}
\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y\left(h^nI_1\right)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n&\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n
\end{pmatrix}\\
&\hspace*{-2cm}=\begin{pmatrix}\theta^2\Delta t^2g\partial_x\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&\theta^2\Delta t^2g\partial_{x}\left(h^n\partial_y((h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
\theta^2\Delta t^2g\partial_y\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot \nabla)u_2^n&\theta^2\Delta t^2g\partial_{y}\left(h^n\partial_y(h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n\end{pmatrix}
\end{split}
\end{equation*}
\end{tiny}
We eventually find

\begin{equation*}
LU(\delta \boldsymbol{u})=\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^n\delta\boldsymbol{u}\right)\right)+\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^n\delta \boldsymbol{u}).
\end{equation*}

To conclude, one has the Schur matrix 
\begin{small}
\begin{equation*}
\hspace*{-1cm}P_{schur}=h^nI_2+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_2+\theta\Delta th^n\nabla\boldsymbol{u}^nI_2-\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^nI_2\right)\right)-\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^nI_2),
\end{equation*}
\end{small}
with $\nabla\boldsymbol{u}^n$ the Jacobian matrix of $\boldsymbol{u}^n$, ie
\begin{equation*}
\nabla\boldsymbol{u}^n=
\begin{pmatrix}
\partial_x u_1^n &\partial_y u_1^n\\ \partial_x u_2^n &\partial_y u_2^n
\end{pmatrix}.
\end{equation*}


\section{Essay 3}
For the red terms we denote $\textcolor{red}{h=h^n+\delta h}$, so
\begin{equation*}
G:\begin{pmatrix}h\\u\\v\end{pmatrix}\mapsto\begin{pmatrix}h+\theta\Delta t\text{div}\left(h(u,v)\right)\\
\textcolor{red}{h}u-u\textcolor{red}{\delta h}+\theta\Delta t h\left(u\partial_xu+v\partial_yu\right)+\theta \Delta thg\partial_x h\\
\textcolor{red}{h}v-v\textcolor{red}{\delta h}+\theta\Delta t h\left(u\partial_xv+v\partial_yv\right)+\theta \Delta thg\partial_y h
\end{pmatrix}.
\end{equation*}

In that case, the Jacobian matrix is
\begin{landscape}
\begin{equation*}
\begin{split}
&\hspace*{-3cm}J_{ac_G}\left(\begin{pmatrix}h\\u\\v\end{pmatrix}\right)\\&\hspace*{-3cm}=
\begin{pmatrix}
I_1+\theta\Delta t\boldsymbol{u}\cdot\left(\nabla I_1\right)+\theta\Delta t\text{div}\left(\boldsymbol{u}\right)I_1& \theta\Delta t(\partial_xh)I_1+h\theta\Delta t(\partial_xI_1)&\theta\Delta t(\partial_yh)I_1+h\theta\Delta t(\partial_yI_1)\\
\theta\Delta tgh(\partial_xI_1)+\theta\Delta tg\left(\partial_xh\right)I_1+\theta\Delta t\left(u\partial_xu+v\partial_yu\right)I_1 & (h-\delta h)I_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thI_1(\partial_xu)+\theta\Delta thv(\partial_yI_1)&h\theta\Delta tI_1\partial_y u\\
\theta\Delta thg(\partial_yI_1)+\theta\Delta tg\left(\partial_yh\right)I_1+\theta\Delta tI_1(u\partial_xv+v\partial_yv)&h\theta\Delta tI_1\partial_x v&(h-\delta h)I_1+\theta\Delta thu(\partial_xI_1)+\theta\Delta thv(\partial_yI_1)+\theta\Delta thI_1\partial_yv
\end{pmatrix}
\end{split}
\end{equation*}
when $I_d$ is the $d\times d$-Identity matrix.



So we have the same $D_1=I_1$ (by hypothesis), the same $U$,

\begin{equation*}
L=\begin{pmatrix}
\theta\Delta t g\partial_x(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_1^n\\
\theta\Delta tg\partial_y(h^nI_1)+\theta\Delta tI_1\left(\boldsymbol{u}^n\cdot\nabla\right)u_2^n
\end{pmatrix}
\end{equation*}
and
\begin{equation*}
D_2=\begin{pmatrix}(h^n-\delta h)I_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot \nabla\right)I_1+\theta\Delta th^n(\partial_xu_1^n)I_1&\theta\Delta th^n(\partial_yu_1^n)I_1\\
\theta\Delta tI_1h^n\partial_xu_2^n&(h^n-\delta h)I_1+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_1+\theta\Delta th^n(\partial_yu_2^n)I_1
\end{pmatrix}
\end{equation*}

We find
\begin{small}
\begin{equation*}
\begin{split}
&\hspace*{-2cm}LU=\\
&\hspace*{-2cm}\begin{pmatrix}
\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&\theta\Delta tg\partial_x(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y\left(h^nI_1\right)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_x(h^nI_1))+\theta\Delta t\theta\Delta t\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n&\theta\Delta tg\partial_y(h^n\theta\Delta t\partial_y(h^nI_1))+\theta\Delta t\theta\Delta t\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n
\end{pmatrix}\\
&\hspace*{-2cm}=\begin{pmatrix}u_1^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_x\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n&u_1^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_{x}\left(h^n\partial_y((h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_1^n\\
u_2^n\theta\Delta t\partial_x\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_y\left(h^n\partial_x(h^nI_1)\right)+\theta^2\Delta t^2\partial_x(h^nI_1)(\boldsymbol{u}^n\cdot \nabla)u_2^n&u_2^n\theta\Delta t\partial_y\left(h^nI_1\right)+\theta^2\Delta t^2g\partial_{y}\left(h^n\partial_y(h^nI_1)\right)+\theta^2\Delta t^2\partial_y(h^nI_1)(\boldsymbol{u}^n\cdot\nabla)u_2^n\end{pmatrix}
\end{split}
\end{equation*}
\end{small}
\end{landscape}
Hence

\begin{equation*}
LU(\delta \boldsymbol{u})=\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^n\delta\boldsymbol{u}\right)\right)+\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^n\delta \boldsymbol{u}).
\end{equation*}

To conclude, one has the Schur matrix 
\begin{small}
\begin{equation*}
\hspace*{-2cm}P_{schur}=(h^n-\delta h)I_2+\theta\Delta th^n\left(\boldsymbol{u}^n\cdot\nabla\right)I_2+\theta\Delta th^n\nabla\boldsymbol{u}^nI_2-\theta^2\Delta t^2g\nabla\left(h^n\nabla\cdot\left(h^nI_2\right)\right)-\theta^2\Delta t^2\left(\boldsymbol{u}^n\cdot\nabla\right)\boldsymbol{u}^n\text{div}(h^nI_2),
\end{equation*}
\end{small}
with $\nabla\boldsymbol{u}^n$ the Jacobian matrix of $\boldsymbol{u}^n$, ie
\begin{equation*}
\nabla\boldsymbol{u}^n=
\begin{pmatrix}
\partial_x u_1^n &\partial_y u_1^n\\ \partial_x u_2^n &\partial_y u_2^n
\end{pmatrix}.
\end{equation*}

\end{document}